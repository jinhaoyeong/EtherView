Detection Workflow

- Entry Points
  
  - Client overview analysis runs when real portfolio data loads and scans every token in the wallet ( src/components/features/portfolio/enhanced-overview.tsx:300–410, 383 ).
  - Server pre-filter runs during wallet analysis to identify obviously suspicious tokens and build a flagged list for the Scam tab ( src/app/api/analyze-wallet/route.ts:218–281, 318–421, 432–471 ).
- Client Pipeline
  
  - Pre-filter patterns: checks token.name and symbol against obvious scam text like “visit website”, URL strings, airdrop/claim bait, etc. If matched, the token is immediately marked high risk and skipped from expensive analysis ( src/components/features/portfolio/enhanced-overview.tsx:326–364 ).
  - Full analysis: calls the advanced engine for remaining tokens to compute risk with structured evidence ( src/components/features/portfolio/enhanced-overview.tsx:383 ).
  - Balanced filtering behavior: only high risk tokens are removed from the overview; medium risk tokens remain visible but marked with warnings, and both appear in the “Potential Scam Tokens” section ( src/components/features/portfolio/enhanced-overview.tsx:388–410, 1115–1176 ).
  - Safety on errors: if a token cannot be analyzed, it is recorded as high risk with an error string for traceability ( src/components/features/portfolio/enhanced-overview.tsx:421–434 ).
- Server Pipeline
  
  - Pre-filter scoring: builds a riskScore by adding points for suspicious name/URL patterns, no price data, unverified contract, micro balance, unusually long names, special characters ( src/app/api/analyze-wallet/route.ts:219–240 ):
    - hasVisitWebsitePattern +30 ( :232 )
    - hasURLPattern +25 ( :233 )
    - hasNoPrice && isUnverified +35 ( :234 )
    - hasNoPrice +15 ( :235 )
    - hasSmallBalance && hasNoPrice +10 ( :237 )
    - hasLongName +15 ( :238 )
    - hasWeirdChars +20 ( :239 )
    - isUnverified +10 ( :240 )
  - Risk banding: riskScore >= 70 → critical , >= 50 → high , >= 25 → medium ; medium+ are flagged with structured evidence ( src/app/api/analyze-wallet/route.ts:243–274 ).
  - Remaining token scan: applies a fast ruleset across non-whitelisted/non-trusted symbols, and escalates to “full scam detection” when suspicious name/URL + no price are present ( src/app/api/analyze-wallet/route.ts:318–421, 432–471 ).
  - Output: flagged tokens are included for the Scam tab, and counts are computed; overview display was temporarily set to include all tokens to ensure visibility ( src/app/api/analyze-wallet/route.ts:731 , :292–293 ).
Engine Internals

- Analysis steps ( src/lib/ai/scam/scamEngine.ts:183–247 )
  
  - Feature extraction: builds comprehensive features from blockchain, market, tokenomics, controls, external signals ( :252–258 ).
  - Honeypot simulation: buy/sell simulation to detect “cannot sell” and compute price impact/slippage ( :263–274 ; simulator details in src/lib/ai/scam/honeypotSimulator.ts:26–90, 108–155 ).
  - Rules detection: merges simulation into features and runs rule categories ( src/lib/ai/scam/scamEngine.ts:279–294 ).
  - ML prediction: generates scam probability from features and rules ( src/lib/ai/scam/scamEngine.ts:299–312 ).
  - Final score: weighted combo 0.6*rules + 0.4*ml , with independent signal overrides that escalate scores to 90/75 on IMMEDIATE/ESCALATE signals ( src/lib/ai/scam/scamEngine.ts:317–335 ).
  - Risk level: score >= 75 → high , >= 40 → medium , else low ( src/lib/ai/scam/scamEngine.ts:345–352 ).
  - Trusted token bonus: reduces score by 60 for known-trusted symbols/addresses ( src/lib/ai/scam/scamEngine.ts:200–205 ).
- Rule categories and key conditions ( src/lib/ai/scam/scamRules.ts:94–132 )
  
  - Static code: unverified contract, blacklist function, dynamic tax setters, trading controls, proxy pattern, honeypot bytecode signature ( src/lib/ai/scam/scamRules.ts:136–229 ).
  - Holder concentration: extreme top-holder percentages escalate risk ( src/lib/ai/scam/scamRules.ts:231–255 ).
  - Liquidity: recent liquidity removal (critical), very low/low liquidity thresholds, new token with low liquidity, high LP ownership concentration ( src/lib/ai/scam/scamRules.ts:286–355 ).
  - Transactions: wash trading pattern, abnormal buy/sell ratio, unusually high transaction volume, concentration of large transfers ( src/lib/ai/scam/scamRules.ts:357–416 ).
  - Tokenomics: infinite supply, suspicious supply changes, high minting activity ( src/lib/ai/scam/scamRules.ts:420–461 ).
  - Tax/fees: abnormal tax rate (>10% escalates by severity, up to critical >50%), dynamic tax, frequent fee changes ( src/lib/ai/scam/scamRules.ts:463–515 ).
  - Simulation: cannot sell (honeypot, critical), price impact >20% (high), slippage >15% (medium), unusual gas ( src/lib/ai/scam/scamRules.ts:517–576 ).
  - External reputation: not on CG/CMC, community reports count, absent social presence, very new token; positive factors reduce score (listings/audits/team public/site quality) ( src/lib/ai/scam/scamRules.ts:578–675 ).
  - Market behavior: pump signals, price manipulation, suspicious transfers ( src/lib/ai/scam/scamRules.ts:678–719 ).
Current Filter Status

- Overview filtering was temporarily disabled to ensure tokens appeared reliably during fetch reliability work:
  - All tokens forced into overview: portfolioData.tokens = allWalletTokens ( src/app/api/analyze-wallet/route.ts:292–293 ).
  - Flagged tokens still collected for the Scam tab ( src/app/api/analyze-wallet/route.ts:731 ).
- Client continues to classify tokens and produce “Potential Scam Tokens” data and counts; high-risk removal in the overview list depends on re-applying the balanced filter behavior during final data assembly ( src/components/features/portfolio/enhanced-overview.tsx:388–410, 1115–1176 ).
Conditions That Mark As Scam

- Immediate high risk
  
  - Obvious phishing/URL patterns in name/symbol ( src/components/features/portfolio/enhanced-overview.tsx:326–364 , src/app/api/analyze-wallet/route.ts:219–233 ).
  - Honeypot bytecode signature ( src/lib/ai/scam/scamRules.ts:216–225 ).
  - Liquidity removed recently (rug pull indicator) ( src/lib/ai/scam/scamRules.ts:291–304 ).
  - Honeypot simulation cannot sell ( src/lib/ai/scam/scamRules.ts:523–537 ).
- High/medium risk accumulation
  
  - Unverified contract, dynamic tax setters, trading controls, blacklist ( src/lib/ai/scam/scamRules.ts:140–202 ).
  - Extreme holder concentration ( src/lib/ai/scam/scamRules.ts:237–255 ).
  - Very low liquidity thresholds ( src/lib/ai/scam/scamRules.ts:306–325 ).
  - Abnormal tax rates (>10% escalating by bands) ( src/lib/ai/scam/scamRules.ts:469–487 ).
  - Pump signals, price manipulation, wash trading ( src/lib/ai/scam/scamRules.ts:363–372, 684–708 ).
  - “Unverified + no price” and other pre-filter signals add risk to medium/high ( src/app/api/analyze-wallet/route.ts:234–240 ).
Re‑Enable Plan

- Overview table
  
  - Replace the temporary “show all” with balanced filtering:
    - Use safe tokens plus medium risk with warnings in the main list; exclude high risk from the main overview.
  - Server path: swap portfolioData.tokens = allWalletTokens with a filtered set or rely on client balanced filtering to remove high risk while retaining medium ( src/app/api/analyze-wallet/route.ts:292–293 ).
  - Client path is already set up to treat high risk differently and present medium risk with warnings ( src/components/features/portfolio/enhanced-overview.tsx:388–410, 1115–1176 ).
- Safety semantics
  
  - Maintain strict safety behavior: analysis failures are treated as high risk on the client ( src/components/features/portfolio/enhanced-overview.tsx:421–434 ).
  - Trusted tokens receive a strong score reduction to avoid false positives for well-known assets ( src/lib/ai/scam/scamEngine.ts:200–205 , src/lib/ai/scam/scamRules.ts:86–91 ).
Validation Checklist

- Run a wallet with mixed tokens:
  - Confirm high risk tokens are hidden from the main overview and appear in “Potential Scam Tokens”.
  - Confirm medium risk tokens remain visible with warnings.
  - Confirm trusted tokens and verified majors are not wrongly flagged due to the trusted bonus.
  - Confirm honeypot cases render as critical with “cannot sell” evidence.